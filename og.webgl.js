!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("og",[],e):"object"==typeof exports?exports.og=e():t.og=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class r{constructor(t,e){this._canvas=document.createElement("canvas"),this._canvas.width=t||256,this._canvas.height=e||256,this._context=this._canvas.getContext("2d")}getCanvas(){return this._canvas}getContext(){return this._context}fillEmpty(){for(var t=this._context.getImageData(0,0,this._canvas.width,this._canvas.height),e=t.data,i=0,r=e.length;i<r;i+=4)e[i]=e[i+1]=e[i+2]=e[i+3]=0;this._context.putImageData(t,0,0)}getData(){return this._context.getImageData(0,0,this._canvas.width,this._canvas.height).data}fillColor(t){this._context.fillStyle=t,this._context.fillRect(0,0,this._canvas.width,this._canvas.height)}setData(t){var e=this._context.createImageData(this._canvas.width,this._canvas.height);e.data.set(t),this._context.putImageData(e,0,0)}resize(t,e){this._canvas.width=t,this._canvas.height=e,this._context=this._canvas.getContext("2d")}drawImage(t,e,i,r,n){this._context=this._canvas.getContext("2d"),this._context.drawImage(t,e||0,i||0,r||t.width,n||t.height)}getImage(){var t=new Image;return t.width=this.getWidth(),t.height=this.getHeight(),t.src=this._canvas.toDataURL("image/png"),t}getTextWidth(t){var e=this._context.measureText(t);return Math.round(e.width)}drawText(t,e,i,r,n){this._context.fillStyle=n||"black",this._context.font=r||"normal 14px Verdana",this._context.fillText(t,e||0,i||14)}getWidth(){return this._canvas.width}getHeight(){return this._canvas.height}loadImage(t,e){var i=new Image,r=this;i.onload=function(){r.resize(i.width,i.height),r._context.drawImage(i,0,0,i.width,i.height),e&&e(i)},i.src=t}openImage(){var t=this.getImage(),e="<!DOCTYPE html>";e+="<html>",e+="<head><title>Print</title></head>",e+="<body>",e+='<img src="'+t.src+'">',e+="</body>",e+="</html>";var i=window.open("","","width="+t.width+"px ,height="+t.height+"px");i.document.open(),i.document.write(e),i.document.close(),i.focus()}destroy(){this._canvas.width=1,this._canvas.height=1,this._canvas=null,this._context=null}}const n=function(t,e){e=e||{},this.handler=t,this._fbo=null,this._rbo=null,this._width=e.width||t.canvas.width,this._height=e.height||t.canvas.height,this._useDepth=void 0==e.useDepth||e.useDepth,this._active=!1,this.texture=e.texture||null};n.prototype.destroy=function(){var t=this.handler.gl;t.deleteTexture(this.texture),t.deleteFramebuffer(this._fbo),t.deleteRenderbuffer(this._rbo),this.texture=null,this._rbo=null,this._fbo=null,this._active=!1},n.prototype.init=function(){var t=this.handler.gl;this._fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),!this.texture&&this.bindOutputTexture(this.handler.createEmptyTexture_l(this._width,this._height)),this._useDepth&&(this._rbo=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._rbo),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._rbo),t.bindRenderbuffer(t.RENDERBUFFER,null)),t.bindFramebuffer(t.FRAMEBUFFER,null)},n.prototype.bindOutputTexture=function(t){var e=this.handler.gl;this.texture=t,e.bindTexture(e.TEXTURE_2D,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.bindTexture(e.TEXTURE_2D,null)},n.prototype.setSize=function(t,e){this._width=t,this._height=e,this._active&&this.handler.gl.viewport(0,0,this._width,this._height),this._useDepth&&(this.destroy(),this.init())},n.prototype.isComplete=function(){var t=this.handler.gl;return t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE},n.prototype.readAllPixels=function(){var t=this.handler.gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo);var e=new Uint8Array(4*this._width*this._height);return t.readPixels(0,0,this._width,this._height,t.RGBA,t.UNSIGNED_BYTE,e),t.bindFramebuffer(t.FRAMEBUFFER,null),e},n.prototype.readPixel=function(t,e){var i=this.handler.gl;i.bindFramebuffer(i.FRAMEBUFFER,this._fbo);var r=new Uint8Array(4);return i.readPixels(t*this._width,e*this._height,1,1,i.RGBA,i.UNSIGNED_BYTE,r),i.bindFramebuffer(i.FRAMEBUFFER,null),r},n.prototype.activate=function(){var t=this.handler.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),t.viewport(0,0,this._width,this._height),this._active=!0;var e=this.handler.framebufferStack.current().data;return e&&(e._active=!1),this.handler.framebufferStack.push(this),this},n.prototype.deactivate=function(){var t=this.handler,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this._active=!1;var i=this.handler.framebufferStack.popPrev();i?(e.bindFramebuffer(e.FRAMEBUFFER,i._fbo),e.viewport(0,0,i._width,i._height)):e.viewport(0,0,t.canvas.width,t.canvas.height)},n.prototype.getImage=function(){var t=this.readAllPixels(),e=new r(this._width,this._height);return e.setData(t),e.getImage()},n.prototype.openImage=function(){var t=this.getImage(),e="<!DOCTYPE html>";e+="<html>",e+="<head><title>Print</title></head>",e+="<body>",e+='<img src="'+t.src+'">',e+="</body>",e+="</html>";var i=window.open("","","width="+t.width+"px ,height="+t.height+"px");i.document.open(),i.document.write(e),i.document.close(),i.focus()};const s=new class{constructor(){this._container=document.createElement("div"),this._container.classList.add("ogConsole"),this._container.style.display="none",document.body&&document.body.appendChild(this._container),this._visibility=!1}getVisibility(){return this._visibility}setVisibility(t){this._visibility!=t&&(this._visibility=t,this._visibility?this.show():this.hide())}show(){this._container.parentNode||document.body&&document.body.appendChild(this._container),this._container.style.display="block",this._visibility=!0}hide(){this._container.style.display="none",this._visibility=!1}logErr(t){var e=document.createElement("div");e.classList.add("ogConsole-text"),e.classList.add("ogConsole-error"),e.innerHTML="error: "+t,console.log(e.innerHTML),this._container.appendChild(e),this.show()}logWrn(t){var e=document.createElement("div");e.classList.add("ogConsole-text"),e.classList.add("ogConsole-warning"),e.innerHTML="warning: "+t,console.log(e.innerHTML),this._container.appendChild(e),this.show()}log(t,e){var i=document.createElement("div");if(i.classList.add("ogConsole-text"),e)for(var r in e)i.style[r]=e[r];i.innerHTML=t,console.log(t),this._container.appendChild(i),this.show()}},h={ReadyState:{Uninitialized:0,Loading:1,Loaded:2,Interactive:3,Complete:4},Status:{OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Forbidden:403,NotFound:404,Gone:410,ServerError:500},Method:{Get:"GET",Post:"POST"},Asynchronous:!0,Synchronous:!1},o={type:h.Method.Get,async:h.Asynchronous,data:null,sender:null,responseType:"text"};h.request=function(t,e){e=e||{};var i,r={};for(i in o)r[i]=o[i];for(i in e)r[i]=e[i];r.data=e.data;var n,s=function(){if(void 0!==typeof XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)for(var t=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(t){console.log("error: og.ajax.createXMLHttp creation filed.")}}(),a=new function(t){var e=t;this.abort=function(){e.aborted=!0,e.abort()}}(s),u=null;if(r.type===h.Method.Post){if(r.data){u="";for(let t in r.data)n=r.data[t],u+=t+"="+encodeURIComponent(n instanceof Object?JSON.stringify(n):n)+"&";u=u.slice(0,-1)}s.open(r.type,t,r.async),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}else if(r.data){var _="?";for(let t in r.data)n=r.data[t],_+=t+"="+encodeURIComponent(n instanceof Object?JSON.stringify(n):n)+"&";_=_.slice(0,-1),s.open(r.type,t+_,r.async)}else s.open(r.type,t,r.async);return r.async&&(s.responseType=r.responseType),s.overrideMimeType("text/plain"),s.onreadystatechange=function(){s.readyState===h.ReadyState.Complete&&(s.status===h.Status.OK?e.success&&e.success.call(e.sender||a,s.response):s.aborted?e.abort&&e.abort.call(e.sender||a,s.response,s.status):e.error&&e.error.call(e.sender||a,s.response,s.status),delete s.onreadystatechange,s.onreadystatechange=null,s=null)},s.send(u),a};Math.PI,Math.PI,Number.MAX_VALUE,Math.log(2);const a=549755748352,u=-a,_=Math.PI/180;Math.PI,Math.sqrt(.5);const l=20037508.34,c=Math.PI/l,p=l/Math.PI,f=.5*Math.PI,m=l/180,d=180/l,E=(Math.PI,Math.PI,180/Math.PI),g=2*l;var T;T=l,Math.atan(Math.exp(T*c));const v=.5*Math.PI,R=(Math.PI,180/Math.PI),b=2*R,A=Math.PI/360,M=R*v,F=function(t,e,i){this.lon=t||0,this.lat=e||0,this.height=i||0};F.join=function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];e[i]=new F(r[0],r[1],r[2])}return e},F.createFromArray=function(t){return new F(t[0],t[1],t[2])},F.forwardMercator=function(t,e,i){return new F(t*m,Math.log(Math.tan((90+e)*A))*p,i)},F.inverseMercator=function(t,e,i){return new F(t*d,b*Math.atan(Math.exp(e*c))-M,i)},F.prototype.set=function(t,e,i){return this.lon=t||0,this.lat=e||0,this.height=i||0,this},F.prototype.copy=function(t){return this.lon=t.lon,this.lat=t.lat,this.height=t.height,this},F.prototype.clone=function(){return new F(this.lon,this.lat,this.height)},F.prototype.forwardMercator=function(){return F.forwardMercator(this.lon,this.lat,this.height)},F.prototype.forwardMercatorEPS01=function(){var t=this.lat;return t>89.9?t=89.9:t<-89.9&&(t=-89.9),new F(this.lon*m,Math.log(Math.tan((90+t)*A))*p)},F.prototype.inverseMercator=function(){return F.inverseMercator(this.lon,this.lat,this.height)},F.prototype.equal=function(t){return t.height?this.lon===t.lon&&this.lat===t.lat&&this.height===t.height:this.lon===t.lon&&this.lat===t.lat};const D=function(t,e){this.southWest=t||new F,this.northEast=e||new F};D.FULL_MERC=new D(F.SW_MERC,F.NE_MERC),D.NORTH_POLE_DEG=new D(F.NW_MERC_DEG,new F(180,90)),D.SOUTH_POLE_DEG=new D(new F(-180,-90),F.SE_MERC_DEG),D.createFromArray=function(t){return new D(new F(t[0],t[1]),new F(t[2],t[3]))},D.createByCoordinates=function(t){for(var e=a,i=u,r=a,n=u,s=0;s<t.length;s++){var h=t[s];h.lon<e&&(e=h.lon),h.lon>i&&(i=h.lon),h.lat<r&&(r=h.lat),h.lat>n&&(n=h.lat)}return new D(new F(e,r),new F(i,n))},D.createByCoordinatesArr=function(t){for(var e=a,i=u,r=a,n=u,s=0;s<t.length;s++){var h=t[s];h[0]<e&&(e=h[0]),h[0]>i&&(i=h[0]),h[1]<r&&(r=h[1]),h[1]>n&&(n=h[1])}return new D(new F(e,r),new F(i,n))},D.fromTile=function(t,e,i,r,n){r=r||g,n=n||g;var s=Math.pow(2,i),h=r/Math.pow(2,i),o=n/s,a=.5*-r+t*h,u=.5*n-e*o,_=a+h;return new D(new F(a,u-o),new F(_,u))},D.prototype.setByCoordinates=function(t){for(var e=a,i=u,r=a,n=u,s=0;s<t.length;s++){var h=t[s];h.lon<e&&(e=h.lon),h.lon>i&&(i=h.lon),h.lat<r&&(r=h.lat),h.lat>n&&(n=h.lat)}return this.southWest.lon=e,this.southWest.lat=r,this.northEast.lon=i,this.northEast.lat=n,this},D.prototype.isInside=function(t){var e=this.southWest,i=this.northEast;return t.lon>=e.lon&&t.lon<=i.lon&&t.lat>=e.lat&&t.lat<=i.lat},D.prototype.overlaps=function(t){var e=this.southWest,i=this.northEast;return e.lon<=t.northEast.lon&&i.lon>=t.southWest.lon&&e.lat<=t.northEast.lat&&i.lat>=t.southWest.lat},D.prototype.getWidth=function(){return this.northEast.lon-this.southWest.lon},D.prototype.getHeight=function(){return this.northEast.lat-this.southWest.lat},D.prototype.clone=function(){return new D(this.southWest.clone(),this.northEast.clone())},D.prototype.getCenter=function(){var t=this.southWest,e=this.northEast;return new F(t.lon+.5*(e.lon-t.lon),t.lat+.5*(e.lat-t.lat))},D.prototype.getNorthWest=function(){return new F(this.southWest.lon,this.northEast.lat)},D.prototype.getNorthEast=function(){return new F(this.northEast.lon,this.northEast.lat)},D.prototype.getSouthWest=function(){return new F(this.southWest.lon,this.southWest.lat)},D.prototype.getSouthEast=function(){return new F(this.northEast.lon,this.southWest.lat)},D.prototype.getNorth=function(){return this.northEast.lat},D.prototype.getEast=function(){return this.northEast.lon},D.prototype.getWest=function(){return this.southWest.lon},D.prototype.getSouth=function(){return this.southWest.lat},D.prototype.equals=function(t){return this.southWest.lon===t.southWest.lon&&this.southWest.lat===t.southWest.lat&&this.northEast.lon===t.northEast.lon&&this.northEast.lat===t.northEast.lat},D.prototype.forwardMercator=function(){return new D(this.southWest.forwardMercator(),this.northEast.forwardMercator())},D.prototype.inverseMercator=function(){return new D(this.southWest.inverseMercator(),this.northEast.inverseMercator())},D.prototype.getCartesianBounds=function(t){for(var e=a,i=u,r=a,n=u,s=a,h=u,o=[new F(this.southWest.lon,this.southWest.lat),new F(this.southWest.lon,this.northEast.lat),new F(this.northEast.lon,this.northEast.lat),new F(this.northEast.lon,this.southWest.lat)],_=0;_<o.length;_++){var l=t.lonLatToCartesian(o[_]),c=l.x,p=l.y,f=l.z;c<e&&(e=c),c>i&&(i=c),p<r&&(r=p),p>n&&(n=p),f<s&&(s=f),f>h&&(h=f)}return[e,i,r,n,s,h]},D.prototype.toString=function(){return"["+this.southWest.lon+", "+this.southWest.lat+", "+this.northEast.lon+", "+this.northEast.lat+"]"};const U=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0};U.identity=new U(0,0,0,1),U.fromVec=function(t){return new U(t[0],t[1],t[2],t[3])},U.prototype.toVec3=function(){return new I(this.x,this.y,this.z)},U.prototype.clone=function(t){return new U(this.x,this.y,this.z,this.w)},U.prototype.equal=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},U.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},U.prototype.toVec=function(){return[this.x,this.y,this.z,this.w]},U.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},U.prototype.set=function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},U.prototype.addA=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},U.prototype.subA=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},U.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},U.prototype.affinity=function(){var t=1/this.w;return this.x*=t,this.y*=t,this.z*=t,this.w=1,this},U.prototype.scaleTo=function(t){return new U(this.x*t,this.y*t,this.z*t,this.w*t)},U.prototype.getStep=function(t){return new U(this.x<t?0:1,this.y<t?0:1,this.z<t?0:1,this.w<t?0:1)},U.prototype.getFrac=function(t){return new U(og.math.frac(t.x),og.math.frac(t.y),og.math.frac(t.z),og.math.frac(t.w))},U.prototype.dot=function(t){return t.x*this.x+t.y*this.y+t.z*this.z+t.w*this.w};const P=function(){this._m=new Array(9)};P.prototype.set=function(t){return this._m[0]=t[0],this._m[1]=t[1],this._m[2]=t[2],this._m[3]=t[3],this._m[4]=t[4],this._m[5]=t[5],this._m[6]=t[6],this._m[7]=t[7],this._m[8]=t[8],this},P.prototype.clone=function(){var t=new P;return t.set(this),t},P.prototype.copy=function(t){return this.set(t._m)},P.prototype.transposeTo=function(){var t=new P,e=this._m;return t._m[0]=e[0],t._m[1]=e[3],t._m[2]=e[6],t._m[3]=e[1],t._m[4]=e[4],t._m[5]=e[7],t._m[6]=e[2],t._m[7]=e[5],t._m[8]=e[8],t},P.prototype.setIdentity=function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=1,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=1,this},P.prototype.mulVec=function(t){var e=t.x,i=t.y,r=t.z,n=this._m;return new I(n[0]*e+n[3]*i+n[6]*r,n[1]*e+n[4]*i+n[7]*r,n[2]*e+n[5]*i+n[8]*r)},P.prototype.toMatrix4=function(){var t=new C,e=t._m,i=this._m;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=0,e[4]=i[3],e[5]=i[4],e[6]=i[5],e[7]=0,e[8]=i[6],e[9]=i[7],e[10]=i[8],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t};const C=function(){this._m=new Array(16),this.left,this.right,this.bottom,this.top,this.near,this.far};C.identity=function(){var t=new C;return t._m[0]=1,t._m[1]=0,t._m[2]=0,t._m[3]=0,t._m[4]=0,t._m[5]=1,t._m[6]=0,t._m[7]=0,t._m[8]=0,t._m[9]=0,t._m[10]=1,t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t},C.prototype.set=function(t){return this._m[0]=t[0],this._m[1]=t[1],this._m[2]=t[2],this._m[3]=t[3],this._m[4]=t[4],this._m[5]=t[5],this._m[6]=t[6],this._m[7]=t[7],this._m[8]=t[8],this._m[9]=t[9],this._m[10]=t[10],this._m[11]=t[11],this._m[12]=t[12],this._m[13]=t[13],this._m[14]=t[14],this._m[15]=t[15],this},C.prototype.clone=function(){var t=new C;return t.set(this),t},C.prototype.copy=function(t){this.set(t._m)},C.prototype.toMatrix3=function(){var t=new P,e=this._m,i=t._m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},C.prototype.mulVec3=function(t){var e=t.x,i=t.y,r=t.z;return new I(this._m[0]*e+this._m[4]*i+this._m[8]*r+this._m[12],this._m[1]*e+this._m[5]*i+this._m[9]*r+this._m[13],this._m[2]*e+this._m[6]*i+this._m[10]*r+this._m[14])},C.prototype.mulVec4=function(t){var e=t.x,i=t.y,r=t.z,n=t.w;return new U(this._m[0]*e+this._m[4]*i+this._m[8]*r+this._m[12]*n,this._m[1]*e+this._m[5]*i+this._m[9]*r+this._m[13]*n,this._m[2]*e+this._m[6]*i+this._m[10]*r+this._m[14]*n,this._m[3]*e+this._m[7]*i+this._m[11]*r+this._m[15]*n)},C.prototype.toInverseMatrix3=function(){var t=this._m,e=t[0],i=t[1],r=t[2],n=t[4],s=t[5],h=t[6],o=t[8],a=t[9],u=t[10],_=u*s-h*a,l=-u*n+h*o,c=a*n-s*o,p=e*_+i*l+r*c;if(!p)return null;p=1/p;var f=new P;return f._m[0]=_*p,f._m[1]=(-u*i+r*a)*p,f._m[2]=(h*i-r*s)*p,f._m[3]=l*p,f._m[4]=(u*e-r*o)*p,f._m[5]=(-h*e+r*n)*p,f._m[6]=c*p,f._m[7]=(-a*e+i*o)*p,f._m[8]=(s*e-i*n)*p,f},C.prototype.inverseTo=function(){var t=this._m[0],e=this._m[1],i=this._m[2],r=this._m[3],n=this._m[4],s=this._m[5],h=this._m[6],o=this._m[7],a=this._m[8],u=this._m[9],_=this._m[10],l=this._m[11],c=this._m[12],p=this._m[13],f=this._m[14],m=this._m[15],d=t*s-e*n,E=t*h-i*n,y=t*o-r*n,g=e*h-i*s,T=e*o-r*s,x=i*o-r*h,v=a*p-u*c,R=a*f-_*c,b=a*m-l*c,A=u*f-_*p,w=u*m-l*p,M=_*m-l*f,F=1/(d*M-E*w+y*A+g*b-T*R+x*v),D=new C;return D._m[0]=(s*M-h*w+o*A)*F,D._m[1]=(-e*M+i*w-r*A)*F,D._m[2]=(p*x-f*T+m*g)*F,D._m[3]=(-u*x+_*T-l*g)*F,D._m[4]=(-n*M+h*b-o*R)*F,D._m[5]=(t*M-i*b+r*R)*F,D._m[6]=(-c*x+f*y-m*E)*F,D._m[7]=(a*x-_*y+l*E)*F,D._m[8]=(n*w-s*b+o*v)*F,D._m[9]=(-t*w+e*b-r*v)*F,D._m[10]=(c*T-p*y+m*d)*F,D._m[11]=(-a*T+u*y-l*d)*F,D._m[12]=(-n*A+s*R-h*v)*F,D._m[13]=(t*A-e*R+i*v)*F,D._m[14]=(-c*g+p*E-f*d)*F,D._m[15]=(a*g-u*E+_*d)*F,D},C.prototype.transposeTo=function(){var t=new C;return t._m[0]=this._m[0],t._m[1]=this._m[4],t._m[2]=this._m[8],t._m[3]=this._m[12],t._m[4]=this._m[1],t._m[5]=this._m[5],t._m[6]=this._m[9],t._m[7]=this._m[13],t._m[8]=this._m[2],t._m[9]=this._m[6],t._m[10]=this._m[10],t._m[11]=this._m[14],t._m[12]=this._m[3],t._m[13]=this._m[7],t._m[14]=this._m[11],t._m[15]=this._m[15],t},C.prototype.setIdentity=function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=1,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=1,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1,this},C.prototype.mul=function(t){let e=this._m[0],i=this._m[1],r=this._m[2],n=this._m[3],s=this._m[4],h=this._m[5],o=this._m[6],a=this._m[7],u=this._m[8],_=this._m[9],l=this._m[10],c=this._m[11],p=this._m[12],f=this._m[13],m=this._m[14],d=this._m[15],E=t._m[0],y=t._m[1],g=t._m[2],T=t._m[3],x=t._m[4],v=t._m[5],R=t._m[6],b=t._m[7],A=t._m[8],w=t._m[9],M=t._m[10],F=t._m[11],D=t._m[12],U=t._m[13],P=t._m[14],z=t._m[15];var B=new C;return B._m[0]=E*e+y*s+g*u+T*p,B._m[1]=E*i+y*h+g*_+T*f,B._m[2]=E*r+y*o+g*l+T*m,B._m[3]=E*n+y*a+g*c+T*d,B._m[4]=x*e+v*s+R*u+b*p,B._m[5]=x*i+v*h+R*_+b*f,B._m[6]=x*r+v*o+R*l+b*m,B._m[7]=x*n+v*a+R*c+b*d,B._m[8]=A*e+w*s+M*u+F*p,B._m[9]=A*i+w*h+M*_+F*f,B._m[10]=A*r+w*o+M*l+F*m,B._m[11]=A*n+w*a+M*c+F*d,B._m[12]=D*e+U*s+P*u+z*p,B._m[13]=D*i+U*h+P*_+z*f,B._m[14]=D*r+U*o+P*l+z*m,B._m[15]=D*n+U*a+P*c+z*d,B},C.prototype.translate=function(t){var e=t.x,i=t.y,r=t.z,n=this._m;return n[12]=n[0]*e+n[4]*i+n[8]*r+n[12],n[13]=n[1]*e+n[5]*i+n[9]*r+n[13],n[14]=n[2]*e+n[6]*i+n[10]*r+n[14],n[15]=n[3]*e+n[7]*i+n[11]*r+n[15],this},C.prototype.translateToPosition=function(t){var e=this._m;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},C.prototype.rotate=function(t,e){var i=Math.cos(e),r=Math.sin(e),n=new C,s=n._m;return s[0]=i+(1-i)*t.x*t.x,s[1]=(1-i)*t.y*t.x-r*t.z,s[2]=(1-i)*t.z*t.x+r*t.y,s[3]=0,s[4]=(1-i)*t.x*t.y+r*t.z,s[5]=i+(1-i)*t.y*t.y,s[6]=(1-i)*t.z*t.y-r*t.x,s[7]=0,s[8]=(1-i)*t.x*t.z-r*t.y,s[9]=(1-i)*t.y*t.z+r*t.x,s[10]=i+(1-i)*t.z*t.z,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this.mul(n)},C.prototype.setRotation=function(t,e){var i=Math.cos(e),r=Math.sin(e),n=this._m;return n[0]=i+(1-i)*t.x*t.x,n[1]=(1-i)*t.y*t.x-r*t.z,n[2]=(1-i)*t.z*t.x+r*t.y,n[3]=0,n[4]=(1-i)*t.x*t.y+r*t.z,n[5]=i+(1-i)*t.y*t.y,n[6]=(1-i)*t.z*t.y-r*t.x,n[7]=0,n[8]=(1-i)*t.x*t.z-r*t.y,n[9]=(1-i)*t.y*t.z+r*t.x,n[10]=i+(1-i)*t.z*t.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},C.prototype.rotateBetweenVectors=function(t,e){return B.getRotationBetweenVectors(t,e).getMat4()},C.prototype.scale=function(t){var e=this._m;return e[0]=e[0]*t.x,e[1]=e[1]*t.x,e[2]=e[2]*t.x,e[3]=e[3]*t.x,e[4]=e[4]*t.y,e[5]=e[5]*t.y,e[6]=e[6]*t.y,e[7]=e[7]*t.y,e[8]=e[8]*t.z,e[9]=e[9]*t.z,e[10]=e[10]*t.z,e[11]=e[11]*t.z,e[12]=e[12],e[13]=e[13],e[14]=e[14],e[15]=e[15],this},C.prototype.setFrustum=function(t,e,i,r,n,s){this.left=t,this.right=e,this.bottom=i,this.top=r,this.near=n,this.far=s;var h=e-t,o=r-i,a=s-n;return this._m[0]=2*n/h,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=2*n/o,this._m[6]=0,this._m[7]=0,this._m[8]=(e+t)/h,this._m[9]=(r+i)/o,this._m[10]=-(s+n)/a,this._m[11]=-1,this._m[12]=0,this._m[13]=0,this._m[14]=-s*n*2/a,this._m[15]=0,this},C.prototype.setPerspective=function(t,e,i,r){return e*=t=i*Math.tan(t*Math.PI/360),this.setFrustum(-e,e,-t,t,i,r)},C.prototype.setOrtho=function(t,e,i,r,n,s){this.left=t,this.right=e,this.bottom=i,this.top=r,this.near=n,this.far=s;var h=1/(t-e),o=1/(i-r),a=1/(n-s),u=this._m;return u[0]=-2*h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*o,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*a,u[11]=0,u[12]=(t+e)*h,u[13]=(r+i)*o,u[14]=(s+n)*a,u[15]=1,this},C.prototype.eulerToMatrix=function(t,e,i){var r=Math.cos(t),n=Math.sin(t),s=Math.cos(e),h=Math.sin(e),o=Math.cos(i),a=Math.sin(i),u=r*h,_=n*h,l=this._m;return l[0]=s*o,l[1]=-s*a,l[2]=-h,l[4]=-_*o+r*a,l[5]=_*a+r*o,l[6]=-n*s,l[8]=u*o+n*a,l[9]=-u*a+n*o,l[10]=r*s,l[3]=l[7]=l[11]=l[12]=l[13]=l[14]=0,l[15]=1,this},C.prototype.getEulerAngles=function(){};const B=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0};B.IDENTITY=new B(0,0,0,1),B.xRotation=function(t){return t*=.5,new B(Math.sin(t),0,0,Math.cos(t))},B.yRotation=function(t){return t*=.5,new B(0,Math.sin(t),0,Math.cos(t))},B.zRotation=function(t){return t*=.5,new B(0,0,Math.sin(t),Math.cos(t))},B.axisAngleToQuat=function(t,e){var i=new B,r=t.normal(),n=.5*e,s=Math.sin(n);return i.set(r.x*s,r.y*s,r.z*s,Math.cos(n)),i},B.getLookAtTargetUp=function(t,e){var i=t.normal();i=I.OrthoNormalize(e,i);var r=e.cross(i),n=new B;n.w=.5*Math.sqrt(1+r.x+e.y+i.z);var s=1/(4*n.w);return n.x=(i.y-e.z)*s,n.y=(r.z-i.x)*s,n.z=(e.x-r.y)*s,n},B.getLookAtSourceDest=function(t,e){var i=e.subA(t).normalize(),r=I.FORWARD.dot(i);if(Math.abs(r- -1)<1e-6)return B.axisAngleToQuat(I.UP,Math.PI);if(Math.abs(r-1)<1e-6)return new B(0,0,0,1);var n=Math.acos(r),s=I.FORWARD.cross(i).normalize();return B.axisAngleToQuat(s,n)},B.getRotationBetweenVectors=function(t,e){var i=t.cross(e);return new B(i.x,i.y,i.z,1+t.dot(e)).normalize()},B.getRotationBetweenVectorsUp=function(t,e,i){var r=t.dot(e);if(Math.abs(r+1)<1e-6)return B.axisAngleToQuat(i,Math.PI);if(Math.abs(r-1)<1e-6)return new B(0,0,0,1);var n=Math.acos(r),s=t.cross(e).normalize();return B.axisAngleToQuat(s,n)},B.prototype.clear=function(){return this.x=this.y=this.z=this.w=0,this},B.prototype.set=function(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this},B.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},B.prototype.setIdentity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},B.prototype.clone=function(){return new B(this.x,this.y,this.z,this.w)},B.prototype.add=function(t){return new B(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},B.prototype.sub=function(t){return new B(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},B.prototype.scaleTo=function(t){return new B(this.x*t,this.y*t,this.z*t,this.w*t)},B.prototype.toVec=function(){return[this.x,this.y,this.z,this.w]},B.prototype.setFromSphericalCoords=function(t,e,i){var r=Math.sin(i/2),n=Math.cos(i/2),s=Math.sin(t),h=Math.cos(t),o=Math.sin(e),a=Math.cos(e);return this.x=r*h*o,this.y=r*s,this.z=r*s*a,this.w=n,this},B.prototype.toSphericalCoords=function(){var t=this.w,e=Math.sqrt(1-t*t);Math.acos(t);Math.abs(e)<5e-4&&(e=1);var i,r=this.x/e,n=this.y/e,s=this.z/e,h=-Math.asin(n);return(i=r*r+s*s<5e-4?0:Math.atan2(r,s))<0&&(i+=360),{lat:h,lon:i,alpha:Math.acos(t)}},B.prototype.setFromAxisAngle=function(t,e){var i=t.normal(),r=.5*e,n=Math.sin(r);return this.set(i.x*n,i.y*n,i.z*n,Math.cos(r)),this},B.prototype.getAxisAngle=function(){var t,e,i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(i>1e-7){var r=1/i;t=new I(x*r,y*r,z*r),e=this.w<0?2*Math.atan2(-i,-w):2*Math.atan2(i,w)}else t=new I(0,0,0),e=0;return{axis:t,angle:e}},B.prototype.setFromEulerAngles=function(t,e,i){var r,n,s,h,o,a,u,l,c,p,f;return r=t*_/2,n=e*_/2,s=i*_/2,h=Math.cos(r),o=Math.cos(n),a=Math.cos(s),u=Math.sin(r),p=o*a,f=(l=Math.sin(n))*(c=Math.sin(s)),this.w=h*p+u*f,this.x=u*p-h*f,this.y=h*l*a+u*o*c,this.z=h*o*c-u*l*a,this.normalize()},B.prototype.getEulerAngles=function(){return this.getMat4().getEulerAngles()},B.prototype.setFromMatrix4=function(t){var e,i,r,n,s,h=[],o=[1,2,0];return(e=(t=t._m)[0]+t[5]+t[10])>0?(i=Math.sqrt(e+1),this.w=i/2,i=.5/i,this.x=(t[6]-t[9])*i,this.y=(t[8]-t[2])*i,this.z=(t[1]-t[4])*i):(r=0,t[5]>t[0]&&(r=1),t[10]>t[5*r]&&(r=2),s=o[n=o[r]],i=Math.sqrt(t[5*r]-(t[5*n]+t[5*s])+1),h[r]=.5*i,0!=i&&(i=.5/i),h[3]=(t[4*n+s]-t[4*s+n])*i,h[n]=(t[4*r+n]+t[4*n+r])*i,h[s]=(t[4*r+s]+t[4*s+r])*i,this.x=h[0],this.y=h[1],this.z=h[2],this.w=h[3]),this},B.prototype.getMat4=function(){var t=new C,e=t._m,i=this.x,r=this.y,n=this.z,s=this.w,h=i+i,o=r+r,a=n+n,u=i*h,_=i*o;i*=a;var l=r*o;return r*=a,n*=a,h*=s,o*=s,s*=a,e[0]=1-(l+n),e[1]=_-s,e[2]=i+o,e[3]=0,e[4]=_+s,e[5]=1-(u+n),e[6]=r-h,e[7]=0,e[8]=i-o,e[9]=r+h,e[10]=1-(u+l),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},B.prototype.mulVec3=function(t){var e=t.x,i=t.y,r=t.z,n=this.x,s=this.y,h=this.z,o=this.w,a=o*e+s*r-h*i,u=o*i+h*e-n*r,_=o*r+n*i-s*e;return new I(a*o+(e=-n*e-s*i-h*r)*-n+u*-h-_*-s,u*o+e*-s+_*-n-a*-h,_*o+e*-h+a*-s-u*-n)},B.prototype.mul=function(t){var e=this.x,i=this.y,r=this.z,n=this.w,s=t.x,h=t.y,o=t.z,a=t.w;return new B(e*a+n*s+i*o-r*h,i*a+n*h+r*s-e*o,r*a+n*o+e*h-i*s,n*a-e*s-i*h-r*o)},B.prototype.conjugate=function(){return new B(-this.x,-this.y,-this.z,this.w)},B.prototype.inverse=function(){var t=1/this.magnitude2();return new B(-this.x*t,-this.y*t,-this.z*t,this.w*t)},B.prototype.magnitude=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return Math.sqrt(t*t+e*e+i*i+r*r)},B.prototype.magnitude2=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return t*t+e*e+i*i+r*r},B.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},B.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,r=this.w,n=Math.sqrt(t*t+e*e+i*i+r*r);return 0==n?(this.x=0,this.y=0,this.z=0,this.w=0,this):(n=1/n,this.x=t*n,this.y=e*n,this.z=i*n,this.w=r*n,this)},B.prototype.isEqual=function(t){var e=this.dot(t);return Math.abs(e-1)<.001},B.prototype.slerp=function(t,e){var i,r,n,s,h,o=this.x,a=this.y,u=this.z,_=this.w,l=t.x,c=t.y,p=t.z,f=t.w;return(r=o*l+a*c+u*p+_*f)<0&&(r=-r,l=-l,c=-c,p=-p,f=-f),1-r>1e-6?(i=Math.acos(r),n=Math.sin(i),s=Math.sin((1-e)*i)/n,h=Math.sin(e*i)/n):(s=1-e,h=e),new B(s*o+h*l,s*a+h*c,s*u+h*p,s*_+h*f)},B.prototype.getRoll=function(t){var e=this.x,i=this.y,r=this.z,n=this.w;if(t){var s=2*i,h=2*r,o=h*n,a=s*e,u=s*i,_=h*r;return Math.atan2(a+o,1-(u+_))}return Math.atan2(2*(e*i+n*r),n*n+e*e-i*i-r*r)},B.prototype.getPitch=function(t){var e=this.x,i=this.y,r=this.z,n=this.w;if(t){var s=2*e,h=2*r,o=s*n,a=s*e,u=h*i,_=h*r;return Math.atan2(u+o,1-(a+_))}return Math.atan2(2*(i*r+n*e),n*n-e*e-i*i+r*r)},B.prototype.getYaw=function(t){var e=this.x,i=this.y,r=this.z,n=this.w;if(t){var s=2*i,h=s*n,o=2*e*e,a=2*r*e,u=s*i;return Math.atan2(a+h,1-(o+u))}return Math.asin(-2*(e*r-n*i))};const I=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};I.UP=new I(0,1,0),I.DOWN=new I(0,-1,0),I.RIGHT=new I(1,0,0),I.LEFT=new I(-1,0,0),I.FORWARD=new I(0,0,-1),I.BACKWARD=new I(0,0,1),I.ZERO=new I,I.fromVec=function(t){return new I(t[0],t[1],t[2])},I.angle=function(t,e){return Math.acos(t.dot(e)/Math.sqrt(t.length2()*e.length2()))},I.lerp=function(t,e,i){return I(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)},I.add=function(t,e){var i=new I(t.x,t.y,t.z);return i.addA(e),i},I.sub=function(t,e){var i=new I(t.x,t.y,t.z);return i.subA(e),i},I.scale=function(t,e){var i=new I(t.x,t.y,t.z);return i.scale(e),i},I.mul=function(t,e){var i=new I(t.x,t.y,t.z);return i.mulA(e),i},I.noncollinear=function(t,e){return t.y*e.z-t.z*e.y||t.z*e.x-t.x*e.z||t.x*e.y-t.y*e.z},I.proj_b_to_plane=function(t,e,i){var r=t.sub(e.scaleTo(e.dot(t)/e.dot(e)));return i&&r.isZero()?new I(i.x,i.y,i.z):r},I.proj_b_to_a=function(t,e){return e.scaleTo(e.dot(t)/e.dot(e))},I.orthoNormalize=function(t,e){return(t=t.normal()).scale(e.dot(t)),e.subA(t).normalize()},I.div=function(t,e){var i=new I(t.x,t.y,t.z);return i.divA(e),i},I.prototype.toVec4=function(){return new U(this.x,this.y,this.z,1)},I.prototype.clone=function(){return new I(this.x,this.y,this.z)},I.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"},I.prototype.isZero=function(){return!(this.x||this.y||this.z)},I.prototype.projToVec=function(t){return t.scaleTo(t.dot(this)/t.dot(t))},I.prototype.equal=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},I.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},I.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},I.prototype.length2=function(){return this.x*this.x+this.y*this.y+this.z*this.z},I.prototype.getQuat=function(){return new B(this.x,this.y,this.z)},I.prototype.addA=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},I.prototype.add=function(t){return new I(this.x+t.x,this.y+t.y,this.z+t.z)},I.prototype.subA=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},I.prototype.sub=function(t){return new I(this.x-t.x,this.y-t.y,this.z-t.z)},I.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},I.prototype.scaleTo=function(t){return new I(this.x*t,this.y*t,this.z*t)},I.prototype.mulA=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},I.prototype.mul=function(t){return new I(this.x*t.x,this.y*t.y,this.z*t.z)},I.prototype.divA=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},I.prototype.div=function(t){return new I(this.x/t.x,this.y/t.y,this.z/t.z)},I.prototype.dot=function(t){return t.x*this.x+t.y*this.y+t.z*this.z},I.prototype.dotArr=function(t){return t[0]*this.x+t[1]*this.y+t[2]*this.z},I.prototype.cross=function(t){return new I(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},I.prototype.clear=function(){return this.x=this.y=this.z=0,this},I.prototype.normal=function(){var t=new I;t.copy(this);var e=1/t.length();return t.x*=e,t.y*=e,t.z*=e,t},I.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},I.prototype.toVec=function(){return[this.x,this.y,this.z]},I.prototype.toArray=function(){return[this.x,this.y,this.z]},I.prototype.distance=function(t){return I.sub(this,t).length()},I.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},I.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},I.prototype.negateTo=function(){return new I(-this.x,-this.y,-this.z)},I.prototype.projToRay=function(t,e){var i=I.proj_b_to_a(I.sub(this,t),e);return i.addA(t),i},I.prototype.angle=function(t){return I.angle(this,t)},I.prototype.lerp=function(t,e){return new I(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e,this.z+(t.z-this.z)*e)},I.prototype.smerp=function(t,e){var i=1-e;return new I(this.x*e+t.x*i,this.y*e+t.y*i,this.z*e+t.z*i)},I.LERP_DELTA=1e-6,I.prototype.slerp=function(t,e){var i=new I;if(e<=0)i.copy(this);else{if(!(e>=1)){var r,n,s,h,o=this.dot(t);return 1-o>I.LERP_DELTA?(r=Math.acos(o),n=Math.sin(r),s=Math.sin((1-e)*r)/n,h=Math.sin(e*r)/n):(s=1-e,h=e),I.add(this.scaleTo(s),t.scale(h))}i.copy(t)}};const L=function(t,e){this.x=t||0,this.y=e||0};function X(t){return null==t}L.UP=new L(0,1),L.DOWN=new L(0,-1),L.RIGHT=new L(1,0),L.LEFT=new L(-1,0),L.ZERO=new L,L.add=function(t,e){var i=new L(t.x,t.y);return i.addA(e),i},L.sub=function(t,e){var i=new oVec2(t.x,t.y);return i.subA(e),i},L.scale=function(t,e){var i=new L(t.x,t.y);return i.scale(e),i},L.mul=function(t,e){var i=new L(t.x,t.y);return i.mulA(e),i},L.div=function(t,e){var i=new L(t.x,t.y);return i.divA(e),i},L.proj_b_to_a=function(t,e){return e.scaleTo(e.dot(t)/e.dot(e))},L.angle=function(t,e){return Math.acos(t.dot(e)/Math.sqrt(t.length2()*e.length2()))},L.orthoNormalize=function(t,e){return(t=t.norm()).scale(e.dot(t)),e.sub(t).normalize()},L.prototype.toVector3=function(){return new I(this.x,this.y,0)},L.prototype.clone=function(){return new L(this.x,this.y)},L.prototype.equal=function(t){return this.x===t.x&&this.y===t.y},L.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},L.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},L.prototype.length2=function(){return this.x*this.x+this.y*this.y},L.prototype.addA=function(t){return this.x+=t.x,this.y+=t.y,this},L.prototype.add=function(t){return new L(this.x+t.x,this.y+t.y)},L.prototype.subA=function(t){return this.x-=t.x,this.y-=t.y,this},L.prototype.sub=function(t){return new L(this.x-t.x,this.y-t.y)},L.prototype.scale=function(t){return this.x*=t,this.y*=t,this},L.prototype.scaleTo=function(t){return new L(this.x*t,this.y*t)},L.prototype.mulA=function(t){return this.x*=t.x,this.y*=t.y,this},L.prototype.mul=function(t){return new L(this.x*t.x,this.y*t.y)},L.prototype.divA=function(t){return this.x/=t.x,this.y/=t.y,this},L.prototype.dot=function(t){return t.x*this.x+t.y*this.y},L.prototype.dotArr=function(t){return t[0]*this.x+t[1]*this.y},L.prototype.cross=function(t){return this.x*t.y-this.y*t.x},L.prototype.clear=function(){return this.x=this.y=0,this},L.prototype.normal=function(){var t=new L;t.copy(this);var e=1/t.length();return t.x*=e,t.y*=e,t},L.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},L.prototype.toVec=function(){return[this.x,this.y]},L.prototype.distance=function(t){return L.sub(this,t).length()},L.prototype.set=function(t,e){return this.x=t,this.y=e,this},L.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},L.prototype.negateTo=function(){return new L(-this.x,-this.y)},L.prototype.projToRay=function(t,e){var i=L.proj_b_to_a(L.sub(this,t),e);return i.add(t),i},L.prototype.angle=function(t){return L.angle(this,t)},L.prototype.lerp=function(t,e,i){var r=L.clone(this);return i<=0?r.copy(t):i>=1?r.copy(e):r=L.add(t,L.sub(e,t).scale(i)),r},L.LERP_DELTA=1e-6,L.prototype.slerp=function(t,e){var i=new L;if(e<=0)i.copy(this);else{if(!(e>=1)){var r,n,s,h,o=this.dot(t);return 1-o>L.LERP_DELTA?(r=Math.acos(o),n=Math.sin(r),s=Math.sin((1-e)*r)/n,h=Math.sin(e*r)/n):(s=1-e,h=e),L.add(this.scale(s),t.scale(h))}i.copy(t)}},"createImageBitmap"in window||(window.createImageBitmap=function(t){return new Promise((e,i)=>{let r=document.createElement("img");r.addEventListener("load",function(){e(this)}),r.src=URL.createObjectURL(t)})});let S=0;function N(t,e,i){for(var r=0,n=t.length-1;r<=n;){var s=n+r>>1,h=i(e,t[s],s);if(h>0)r=s+1;else{if(!(h<0))return s;n=s-1}}return-r-1}class O{constructor(t,e){this._eventNames=[],t&&this.registerNames(t),this._sender=e||this,this._counter=0,this._stopPropagation=!1,this._stampCache={},this.__id=O.__staticCounter++}static get _staticCounter(){return this._counter||0===this._counter||(this._counter=0),this._counter}static set _staticCounter(t){this._counter=t}bindSender(t){this._sender=t||this}registerNames(t){for(var e=0;e<t.length;e++)this[t[e]]={active:!0,handlers:[]},this._eventNames.push(t[e])}_stamp(t,e){var i=function(t){var e=t._openglobus_id;return e||(e=t._openglobus_id=++S),e}(e),r=t+"_"+this.__id+"_"+i;return!this._stampCache[r]&&(this._stampCache[r]=i,!0)}on(t,e,i){this._stamp(t,e)&&this[t]&&this[t].handlers.unshift(e.bind(i||this._sender))}off(t,e){var i=t+"_"+this.__id+"_"+e._openglobus_id;if(e._openglobus_id&&this._stampCache[i]){for(var r=this[t].handlers,n=r.length,s=-1;n--;){if(r[n]._openglobus_id===e._openglobus_id){s=n;break}}-1!==s&&(r.splice(s,1),this._stampCache[i]=void 0,delete this._stampCache[i])}}dispatch(t,e){if(t&&t.active)for(var i=t.handlers,r=i.length;r--&&!this._stopPropagation;)i[r](e);this._stopPropagation=!1}stopPropagation(){this._stopPropagation=!0}clear(){for(var t=0;t<this._eventNames.length;t++){var e=this[this._eventNames[t]];e.handlers.length=0,e.handlers=[]}this._eventNames.length=0,this._eventNames=[]}}const G=.001,W=1e3,V=60,k=1/V,H=3600,Y=1/H,q=12*H,j=86400,K=1/864e5,Z=1/j,Q=2451545;function J(t){var e,i,r,n,s,h=(e=t.getUTCFullYear(),i=t.getUTCMonth()+1,r=t.getUTCDate(),(1461*(s=e+4800+(n=(i-14)/12|0))/4|0)+(367*(i-2-12*n)/12|0)-(3*((s+100)/100|0)/4|0)+r-32075),o=t.getUTCHours()-12;o<0&&(o+=24);var a=t.getUTCSeconds()+o*H+t.getUTCMinutes()*V+t.getUTCMilliseconds()*G;a>=q&&h--;var u=a*Z|0;return h+=u,(a-=j*u)<0&&(h--,a+=j),h+a*Z}function $(t){var e=it,i=N(e,t,function(t,e){return t-e.jd});i<0&&(i=~i),i>=e.length&&(i=e.length-1);var r=e[i].leapSeconds;return 0!==i&&(e[i].jd-t)*j>r&&(r=e[i-1].leapSeconds),t+r*Z}function tt(t){var e=0|t,i=(t-e)*j;i>=q&&e++;var r=e+68569|0,n=4*r/146097|0,s=4e3*((r=r-((146097*n+3)/4|0)|0)+1)/1461001|0,h=80*(r=r-(1461*s/4|0)+31|0)/2447|0,o=r-(2447*h/80|0)|0,a=h+2-12*(r=h/11|0)|0,u=100*(n-49)+s+r|0,_=i*Y|0,l=i-_*H,c=l*k|0,p=0|(l-=c*V),f=(l-p)*W|0;return(_+=12)>23&&(_-=24),new Date(Date.UTC(u,a-1,o,_,c,p,f))}function et(t,e){return{jd:t,leapSeconds:e}}const it=[et(2441317.5,10),et(2441499.5,11),et(2441683.5,12),et(2442048.5,13),et(2442413.5,14),et(2442778.5,15),et(2443144.5,16),et(2443509.5,17),et(2443874.5,18),et(2444239.5,19),et(2444786.5,20),et(2445151.5,21),et(2445516.5,22),et(2446247.5,23),et(2447161.5,24),et(2447892.5,25),et(2448257.5,26),et(2448804.5,27),et(2449169.5,28),et(2449534.5,29),et(2450083.5,30),et(2450630.5,31),et(2451179.5,32),et(2453736.5,33),et(2454832.5,34),et(2456109.5,35),et(2457204.5,36)];$(Q);class rt{static get _staticCounter(){return this._counter||0===this._counter||(this._counter=0),this._counter}static set _staticCounter(t){this._counter=t}constructor(t){t=t||{},this._id=rt._staticCounter++,this.name=t.name||"",this.events=new O(["tick","end"],this),this.startDate=t.startDate||0,this.endDate=t.endDate||0;var e=t.currentDate||J(new Date);t.startDate&&e<t.startDate&&(e=t.startDate),t.endDate&&e>t.endDate&&(e=t.endDate),this.currentDate=e,this.multiplier=void 0!==t.multiplier?t.multiplier:1,this.deltaTicks=0,this.active=!0}setDate(t){var e=J(t);this.startDate&&e<this.startDate&&(e=this.startDate),this.endDate&&e>this.endDate&&(e=this.endDate),this.currentDate=e}getDate(){return tt(this.currentDate)}reset(){this.startDate&&(this.currentDate=this.startDate)}_tick(t){if(this.deltaTicks=t*this.multiplier,this.active){var e=(i=this.currentDate,r=this.deltaTicks,i+r*K);this.multiplier>0?this.endDate&&e>this.endDate?(this.currentDate=this.startDate,this.events.dispatch(this.events.end,this)):this.currentDate=e:this.startDate&&e<this.startDate?(this.currentDate=this.endDate,this.events.dispatch(this.events.end,this)):this.currentDate=e,this.events.dispatch(this.events.tick,this)}var i,r}equal(t){return this._id===t._id}}const nt=function(t,e){this._program=e,this._handler=t,this._activated=!1};nt.prototype.initialize=function(){this._program.createProgram(this._handler.gl)},nt.prototype.getProgram=function(){return this._program},nt.prototype.activate=function(){if(!this._activated){this._handler.activeProgram.deactivate(),this._handler.activeProgram=this;var t=this._program;this._activated=!0,t.enableAttribArrays(),t.use()}return this},nt.prototype.remove=function(){var t=this._handler.Programs;t[this._program.name]&&(this._activated&&this.deactivate(),this._program.delete(),t[this._program.name]=null,delete t[this._program.name])},nt.prototype.deactivate=function(){this._program.disableAttribArrays(),this._activated=!1},nt.prototype.isActive=function(){return this._activated},nt.prototype.set=function(t){return this.activate(),this._program.set(t),this},nt.prototype.drawIndexBuffer=function(t,e){return this._program.drawIndexBuffer(t,e),this},nt.prototype.drawArray=function(t,e){return this._program.drawArray(t,e),this};class st{constructor(){this.next=null,this.prev=null,this.data=null}}class ht{constructor(t=256){this._current=new st,this._head=this._current;for(var e=0;e<t;e++){var i=new st;i.prev=this._current,this._current.next=i,this._current=i}this._current=this._head}current(){return this._current}push(t){this._current=this._current.next,this._current.data=t}pop(t){return this._current=this._current.prev,this._current.next.data}popPrev(t){return this._current=this._current.prev,this._current.data}}const ot=["","WEBKIT_","MOZ_"],at=function(t,e){this.defaultClock=new rt,this._clocks=[],this.deltaTime=0,this.canvas=null,this.gl=null,this.Programs={},this.activeProgram=null,this._params=e||{},this._params.anisotropy=this._params.anisotropy||8;var i=this._params.width;i>4096&&(i=4096),this._params.width=i||256;var r=this._params.height;r>4096&&(r=4096),this._params.height=r||256,this._params.context=this._params.context||{},this._params.extensions=this._params.extensions||[],this._oneByHeight=1/this._params.height,this.extensions={},this._id=t,this._lastAnimationFrameTime=0,this._initialized=!1,this._frameCallback=function(){},this.transparentTexture=null,this.framebufferStack=new ht,(e.autoActivate||X(e.autoActivate))&&this.initialize()};at.getExtension=function(t,e){var i,r;for(i in ot)if(r=t.getExtension(ot[i]+e))return r;return null},at.getContext=function(t,e){var i;try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)}catch(t){s.logErr("exception during the GL context initialization")}return i||s.logErr("could not initialise WebGL"),i},at.prototype.setFrameCallback=function(t){t&&(this._frameCallback=t)},at.prototype.createTexture_n=function(t){var e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},at.prototype.createEmptyTexture_hf=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.HALF_FLOAT_OES,null),i.bindTexture(i.TEXTURE_2D,null),r},at.prototype.createEmptyTexture_f=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.FLOAT,null),i.bindTexture(i.TEXTURE_2D,null),r},at.prototype.createEmptyTexture_n=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null),r},at.prototype.createEmptyTexture_l=function(t,e){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null),r},at.prototype.createTexture_l=function(t){var e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},at.prototype.createTexture_mm=function(t){var e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},at.prototype.createTexture_a=function(t){var e=this.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameterf(e.TEXTURE_2D,this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._params.anisotropy),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),i},at.prototype.createTexture=function(t){return this.createTexture_a(t)},at.prototype.loadCubeMapTexture=function(t){var e=this.gl,i=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,i),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);var n=[[t.px,e.TEXTURE_CUBE_MAP_POSITIVE_X],[t.nx,e.TEXTURE_CUBE_MAP_NEGATIVE_X],[t.py,e.TEXTURE_CUBE_MAP_POSITIVE_Y],[t.ny,e.TEXTURE_CUBE_MAP_NEGATIVE_Y],[t.pz,e.TEXTURE_CUBE_MAP_POSITIVE_Z],[t.nz,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]],s=new r;s.fillEmpty();for(var h=s.getImage(),o=0;o<n.length;o++){var a=n[o][1];e.bindTexture(e.TEXTURE_CUBE_MAP,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(a,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h)}for(o=0;o<n.length;o++){a=n[o][1];var u=new Image;u.crossOrigin="",u.onload=function(t,i,r){return function(){e.bindTexture(e.TEXTURE_CUBE_MAP,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(i,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}}(i,a,u),u.src=n[o][0]}return i},at.prototype.addProgram=function(t,e){if(this.Programs[t.name])!COMPILED&&s.logWrn("og.webgl.Handler:284 - shader program: '"+t.name+"' is allready exists.");else{var i=new nt(this,t);this.Programs[t.name]=i,this._initProgramController(i),e&&(i._activated=!1)}return t},at.prototype.removeProgram=function(t){this.Programs[t]&&this.Programs[t].remove()},at.prototype.addPrograms=function(t){for(var e=0;e<t.length;e++)this.addProgram(t[e])},at.prototype._initProgramController=function(t){this._initialized&&(t.initialize(),this.activeProgram?(t.deactivate(),this.activeProgram._program.enableAttribArrays(),this.activeProgram._program.use()):(this.activeProgram=t,t.activate()))},at.prototype._initPrograms=function(){for(var t in this.Programs)this._initProgramController(this.Programs[t])},at.prototype.initializeExtension=function(t,e){if(!this.extensions||!this.extensions[t]){var i=at.getExtension(this.gl,t);i?this.extensions[t]=i:e&&!COMPILED&&s.logWrn("og.webgl.Handler: extension '"+t+"' doesn't initialize.")}return this.extensions&&this.extensions[t]},at.prototype.initialize=function(){this._id?this.canvas=document.getElementById(this._id):(this.canvas=document.createElement("canvas"),this.canvas.width=this._params.width,this.canvas.height=this._params.height),this.gl=at.getContext(this.canvas,this._params.context),this._initialized=!0,this._params.extensions.push("OES_standard_derivatives"),this._params.extensions.push("EXT_texture_filter_anisotropic"),this._params.extensions.push("OES_element_index_uint");for(var t=this._params.extensions.length;t--;)this.initializeExtension(this._params.extensions[t],!0);this.extensions.EXT_texture_filter_anisotropic||(this.createTexture=this.createTexture_mm),this._initPrograms(),this._setDefaults()},at.prototype._setDefaults=function(){this.activateDepthTest(),this.setSize(this._params.width,this._params.height),this.gl.frontFace(this.gl.CCW),this.gl.cullFace(this.gl.BACK),this.activateFaceCulling(),this.deactivateBlending();var t=this;this.createDefaultTexture({color:"rgba(0,0,0,0.0)"},function(e){t.transparentTexture=e})},at.prototype.activateDepthTest=function(){this.gl.enable(this.gl.DEPTH_TEST)},at.prototype.deactivateDepthTest=function(){this.gl.disable(this.gl.DEPTH_TEST)},at.prototype.activateFaceCulling=function(){this.gl.enable(this.gl.CULL_FACE)},at.prototype.deactivateFaceCulling=function(){this.gl.disable(this.gl.CULL_FACE)},at.prototype.activateBlending=function(){this.gl.enable(this.gl.BLEND)},at.prototype.deactivateBlending=function(){this.gl.disable(this.gl.BLEND)},at.prototype.createArrayBuffer=function(t,e,i,r){var n=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,r||this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),n.itemSize=e,n.numItems=i,n},at.prototype.createElementArrayBuffer=function(t,e,i,r){var n=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,r||this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),n.itemSize=e,n.numItems=i||t.length,n},at.prototype.setSize=function(t,e){t>4096&&(t=4096),e>4096&&(e=4096),this._params.width=t,this._params.height=e,this.canvas.width=t,this.canvas.height=e,this._oneByHeight=1/e,this.gl&&this.gl.viewport(0,0,t,e),this.onCanvasResize&&this.onCanvasResize(this.canvas)},at.prototype.getWidth=function(){return this.canvas.width},at.prototype.getHeight=function(){return this.canvas.height},at.prototype.getClientAspect=function(){return this.canvas.clientWidth/this.canvas.clientHeight},at.prototype.getCenter=function(){var t=this.canvas;return new L(Math.round(.5*t.width),Math.round(.5*t.height))},at.prototype.drawFrame=function(){var t=(new Date).getTime();this.deltaTime=t-this._lastAnimationFrameTime,this._lastAnimationFrameTime=t,this.defaultClock._tick(this.deltaTime);for(var e=0;e<this._clocks.length;e++)this._clocks[e]._tick(this.deltaTime);var i=this.canvas;i.clientWidth===i.width&&i.clientHeight===i.height||this.setSize(i.clientWidth,i.clientHeight),this._frameCallback()},at.prototype.clearFrame=function(){var t=this.gl;this.gl.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},at.prototype.start=function(){if(!this._requestAnimationFrameId&&this._initialized){var t=new Date;this._lastAnimationFrameTime=t.getTime(),this.defaultClock.setDate(t),this._animationFrameCallback()}},at.prototype.stop=function(){this._requestAnimationFrameId&&(window.cancelAnimationFrame(this._requestAnimationFrameId),this._requestAnimationFrameId=null)},at.prototype._animationFrameCallback=function(){this._requestAnimationFrameId=window.requestAnimationFrame(()=>{this.drawFrame(),this._animationFrameCallback()})},at.prototype.createDefaultTexture=function(t,e){var i,n;if(t&&t.color)(i=new r(2,2)).fillColor(t.color),(n=this.createTexture_n(i._canvas)).default=!0,e(n);else if(t&&t.url){var s=new Image,h=this;s.onload=function(){(n=h.createTexture(this)).default=!0,e(n)},s.src=t.url}else(i=new r(2,2)).fillColor("#C5C5C5"),(n=this.createTexture_n(i._canvas)).default=!0,e(n)},at.prototype.destroy=function(){var t=this.gl;for(var e in this.stop(),this.Programs)this.removeProgram(e);t.deleteTexture(this.transparentTexture),this.transparentTexture=null,this.framebufferStack=null,this.framebufferStack=new ht,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas.width=1,this.canvas.height=1,this.canvas=null;var i=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);for(var n=0;n<i;++n)t.disableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(n,0);t.deleteBuffer(r);var s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<s;++n)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),this.gl=null,this._initialized=!1},at.prototype.addClock=function(t){t.__handler||(t.__handler=this,this._clocks.push(t))},at.prototype.addClocks=function(t){for(var e=0;e<t.length;e++)this.addClock(t[e])},at.prototype.removeClock=function(t){if(t.__handler)for(var e=this._clocks,i=e.length;i--;)if(e[i].equal(t)){t.__handler=null,e.splice(i,1);break}};const ut=function(t,e){e=e||{},this.handler=t,this._fbo=null,this._pFbo=[],this._rbo=null,this._size=e.size||1,this._width=e.width||256,this._height=e.height||256,this.textures=[],this._active=!1};ut.prototype.destroy=function(){var t=this.handler.gl;t.deleteFramebuffer(this._fbo),this._fbo=null,t.deleteRenderbuffer(this._rbo),this._rbo=null;for(var e=0;e<this._size;e++)t.deleteTexture(this.textures[e]),t.deleteFramebuffer(this._pFbo[e]);this.textures.length=0,this.textures=[],this._pFbo.length=0,this._pFbo=[]},ut.prototype.init=function(){var t=this.handler.gl,e=this.handler.extensions.WEBGL_draw_buffers;this._fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._fbo);for(var i=[],r=0;r<this._size;r++)i[r]=e.COLOR_ATTACHMENT0_WEBGL+r;e.drawBuffersWEBGL(i);for(r=0;r<this._size;r++)this.textures[r]=this.handler.createEmptyTexture_l(this._width,this._height),t.bindTexture(t.TEXTURE_2D,this.textures[r]),t.framebufferTexture2D(t.FRAMEBUFFER,e.COLOR_ATTACHMENT0_WEBGL+r,t.TEXTURE_2D,this.textures[r],0),t.bindTexture(t.TEXTURE_2D,null),i[r]=e.COLOR_ATTACHMENT0_WEBGL+r;this._rbo=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._rbo),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._width,this._height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._rbo),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null);for(r=0;r<this._size;r++)this._pFbo[r]=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._pFbo[r]),t.bindTexture(t.TEXTURE_2D,this.textures[r]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.textures[r],0),t.bindTexture(t.TEXTURE_2D,null);t.bindFramebuffer(t.FRAMEBUFFER,null)},ut.prototype.setSize=function(t,e){this._width=t,this._height=e,this.destroy(),this.init()},ut.prototype.readAllPixels=function(t){var e=this.handler.gl;e.bindFramebuffer(e.FRAMEBUFFER,this._pFbo[t||0]);var i=new Uint8Array(4*this._width*this._height);return e.readPixels(0,0,this._width,this._height,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null),i},ut.prototype.readPixel=function(t,e,i){var r=this.handler.gl;r.bindFramebuffer(r.FRAMEBUFFER,this._pFbo[i||0]);var n=new Uint8Array(4);return r.readPixels(t*this._width,e*this._height,1,1,r.RGBA,r.UNSIGNED_BYTE,n),r.bindFramebuffer(r.FRAMEBUFFER,null),n},ut.prototype.isComplete=function(){var t=this.handler.gl;return t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE?(t.bindFramebuffer(t.FRAMEBUFFER,null),!0):(t.bindFramebuffer(t.FRAMEBUFFER,null),!1)},ut.prototype.activate=function(){var t=this.handler,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),e.viewport(0,0,this._width,this._height),this._active=!0;var i=this.handler.framebufferStack.current().data;return i&&(i._active=!1),t.framebufferStack.push(this),this},ut.prototype.deactivate=function(){var t=this.handler,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.canvas.width,t.canvas.height),this._active=!1;var i=t.framebufferStack.popPrev();i?(e.bindFramebuffer(e.FRAMEBUFFER,i._fbo),e.viewport(0,0,i._width,i._height)):e.viewport(0,0,t.canvas.width,t.canvas.height)},ut.prototype.getImage=function(t){var e=this.readAllPixels(t),i=new r(this._width,this._height);return i.setData(e),i.getImage()},ut.prototype.openImage=function(t){var e=this.getImage(t),i="<!DOCTYPE html>";i+="<html>",i+="<head><title>Print</title></head>",i+="<body>",i+='<img src="'+e.src+'">',i+="</body>",i+="</html>";var r=window.open("","","width="+e.width+"px ,height="+e.height+"px");r.document.open(),r.document.write(i),r.document.close(),r.focus()};let _t=["FLOAT","DOUBLE","BOOL","INT","UINT","VEC2","VEC3","VEC4","DVEC2","DVEC3","DVEC4","BVEC2","BVEC3","BVEC4","IVEC2","IVEC3","IVEC4","UVEC2","UVEC3","UVEC4","MAT2","DMAT2","MAT3","DMAT3","MAT4","DMAT4","MAT2X3","MAT2X4","MAT3X2","MAT3X4","MAT4X2","MAT4X3","DMAT2X3","DMAT2X4","DMAT3X2","DMAT3X4","DMAT4X2","DMAT4X3","SAMPLER1D","SAMPLER2D","SAMPLER3D","SAMPLERCUBE","SAMPLER2DSHADOW","SAMPLER2DXX","INTXX","FLOATXX"];const lt={};for(let t=0;t<_t.length;t++)lt[_t[t]]=t;const ct={};for(let t=0;t<_t.length;t++)ct[_t[t].toLowerCase()]=lt[_t[t]];const pt={u:[],a:[]};pt.u[lt.MAT4]=function(t,e){t.gl.uniformMatrix4fv(e._pName,!1,e.value)},pt.u[lt.MAT3]=function(t,e){t.gl.uniformMatrix3fv(e._pName,!1,e.value)},pt.u[lt.FLOAT]=function(t,e){t.gl.uniform1f(e._pName,e.value)},pt.u[lt.INT]=function(t,e){t.gl.uniform1i(e._pName,e.value)},pt.u[lt.VEC2]=function(t,e){t.gl.uniform2fv(e._pName,e.value)},pt.u[lt.VEC3]=function(t,e){t.gl.uniform3fv(e._pName,e.value)},pt.u[lt.VEC4]=function(t,e){t.gl.uniform4fv(e._pName,e.value)},pt.u[lt.SAMPLER2D]=function(t,e){let i=t.gl;i.activeTexture(i.TEXTURE0+t._textureID),i.bindTexture(i.TEXTURE_2D,e.value),i.uniform1i(e._pName,t._textureID),t._textureID++},pt.u[lt.SAMPLERCUBE]=function(t,e){let i=t.gl;i.activeTexture(i.TEXTURE0+t._textureID),i.bindTexture(i.TEXTURE_CUBE_MAP,e.value),i.uniform1i(e._pName,t._textureID),t._textureID++},pt.u[lt.SAMPLER2DXX]=function(t,e){let i=t.gl,r=e.value.length,n=new Int32Array(r);for(let s=0;s<r;s++)i.activeTexture(i.TEXTURE0+t._textureID+s),i.bindTexture(i.TEXTURE_2D,e.value[s]),n[s]=s;i.uniform1iv(e._pName,n)},pt.u[lt.INTXX]=function(t,e){pgl.uniform1iv(e._pName,e.value)},pt.u[lt.FLOATXX]=function(t,e){t.gl.uniform1fv(e._pName,e.value)},pt.a[lt.FLOAT]=function(t,e){t.gl.vertexAttrib1f(e._pName,e.value)},pt.a[lt.VEC2]=function(t,e){t.gl.vertexAttrib2fv(e._pName,e.value)},pt.a[lt.VEC3]=function(t,e){t.gl.vertexAttrib3fv(e._pName,e.value)},pt.a[lt.VEC4]=function(t,e){t.gl.vertexAttrib4fv(e._pName,e.value)};class ft{constructor(t,e){this.name=t,this.attributes={},this.uniforms={},this._attributes={};for(let t in e.attributes)"string"==typeof e.attributes[t]||"number"==typeof e.attributes[t]?this._attributes[t]={type:e.attributes[t]}:this._attributes[t]=e.attributes[t];this._uniforms={};for(let t in e.uniforms)"string"==typeof e.uniforms[t]||"number"==typeof e.uniforms[t]?this._uniforms[t]={type:e.uniforms[t]}:this._uniforms[t]=e.uniforms[t];this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.gl=null,this._variables={},this._p=null,this._textureID=0,this._attribArrays=[]}use(){this.gl.useProgram(this._p)}set(t){for(var e in this._textureID=0,t)this._variables[e].value=t[e],this._variables[e]._callback(this,this._variables[e])}apply(){this._textureID=0;var t=this._variables;for(var e in t)t[e]._callback(this,t[e])}drawIndexBuffer(t,e){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e),this.gl.drawElements(t,e.numItems,this.gl.UNSIGNED_SHORT,0)}drawArray(t,e){this.gl.drawArrays(t,0,e)}_getShaderCompileStatus(t,e){return this.gl.shaderSource(t,e),this.gl.compileShader(t),!!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)||(s.logErr("og/Program/Program:"+this.name+" - "+this.gl.getShaderInfoLog(t)+"."),!1)}_createVertexShader(t){var e=this.gl.createShader(this.gl.VERTEX_SHADER);return this._getShaderCompileStatus(e,t)?e:null}_createFragmentShader(t){var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this._getShaderCompileStatus(e,t)?e:null}disableAttribArrays(){for(var t=this.gl,e=this._attribArrays,i=e.length;i--;)t.disableVertexAttribArray(e[i])}enableAttribArrays(){for(var t=this.gl,e=this._attribArrays,i=e.length;i--;)t.enableVertexAttribArray(e[i])}delete(){this.gl.deleteProgram(this._p)}createProgram(t){this.gl=t,this._p=this.gl.createProgram();var e=this._createFragmentShader(this.fragmentShader),i=this._createVertexShader(this.vertexShader);if(t.attachShader(this._p,e),t.attachShader(this._p,i),t.linkProgram(this._p),!t.getProgramParameter(this._p,t.LINK_STATUS))return s.logErr("og/Program/Program:"+this.name+" - couldn't initialise shaders. "+t.getProgramInfoLog(this._p)+"."),void t.deleteProgram(this._p);for(var r in this.use(),this._attributes){if(this._variables[r]=this._attributes[r],this._attributes[r].enableArray=void 0==this._attributes[r].enableArray||this._attributes[r].enableArray,this._attributes[r].enableArray?this._attributes[r]._callback=ft.bindBuffer:"string"==typeof this._attributes[r].type?this._attributes[r]._callback=pt.a[ct[this._attributes[r].type.trim().toLowerCase()]]:this._attributes[r]._callback=pt.a[this._attributes[r].type],this._p[r]=t.getAttribLocation(this._p,r),void 0==this._p[r])return s.logErr("og/Program/Program:"+this.name+" - attribute '"+r+"' is not exists."),void t.deleteProgram(this._p);this._attributes[r].enableArray&&(this._attribArrays.push(this._p[r]),t.enableVertexAttribArray(this._p[r])),this._attributes[r]._pName=this._p[r],this.attributes[r]=this._p[r]}for(var n in this._uniforms){if("string"==typeof this._uniforms[n].type?this._uniforms[n]._callback=pt.u[ct[this._uniforms[n].type.trim().toLowerCase()]]:this._uniforms[n]._callback=pt.u[this._uniforms[n].type],this._variables[n]=this._uniforms[n],this._p[n]=t.getUniformLocation(this._p,n),void 0==this._p[n])return s.logErr("og/Program/Program:"+this.name+" - uniform '"+n+"' is not exists."),void t.deleteProgram(this._p);this._uniforms[n]._pName=this._p[n],this.uniforms[n]=this._p[n]}t.detachShader(this._p,e),t.detachShader(this._p,i)}static bindBuffer(t,e){var i=t.gl;i.bindBuffer(i.ARRAY_BUFFER,e.value),i.vertexAttribPointer(e._pName,e.value.itemSize,i.FLOAT,!1,0,0)}}i.d(e,"Handler",function(){return at}),i.d(e,"Framebuffer",function(){return n}),i.d(e,"MultiFramebuffer",function(){return ut}),i.d(e,"types",function(){return lt}),i.d(e,"Program",function(){return ft})}])});